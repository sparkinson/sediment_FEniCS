\documentclass[11pt,a4paper]{article}
\usepackage{dsfont}
\usepackage{graphicx}
\usepackage{subfigure}
\usepackage{pdflscape}
\usepackage{float}
\usepackage{natbib}
\usepackage{amsmath}
\usepackage[top=2cm,bottom=2cm,left=2.2cm,right=2.2cm]{geometry}
\usepackage{setspace}
\usepackage{indentfirst}
\usepackage[font=small,format=plain,labelfont=bf,up,%% textfont=it
  ,up]{caption}
\usepackage{tikz}
\usetikzlibrary{calc,3d}
\setlength{\parindent}{10pt}
\setlength{\parskip}{7pt}
\usepackage{upgreek}
\usepackage{breqn}
\setlength{\belowdisplayskip}{6pt plus 2pt minus 1pt}
\setlength{\belowdisplayshortskip}{6pt plus 1pt minus 1pt}
\setlength{\abovedisplayskip}{6pt plus 2pt minus 1pt}
\setlength{\abovedisplayshortskip}{6pt plus 1pt minus 1pt}

%% \doublespacing    

\bibliographystyle{plainnat}

\title{}
\author{Samuel Parkinson}
\date{\today}

\begin{document}
\begin{dgroup*}
  \begin{dmath}
    \dot{{\bf u}}_i + {\bf u}_i \cdot \nabla_j {\bf u}_k - \nabla_i \cdot \nu_{ij} \left( \nabla_i {\bf u}_j + \nabla_j {\bf u}_i \right) = {\bf f}_i - \nabla_i p 
  \end{dmath}
  \intertext{For constant viscosity}
  \begin{dmath}
    \nabla_i \cdot \nu_{ij} \left( \nabla_i {\bf u}_j + \nabla_j {\bf u}_i \right) 
    = \nu_{ij} \left( \nabla_i \cdot \left(\nabla_i \right) {\bf u}_j + \nabla_i \cdot \left(\nabla_j \right) {\bf u}_i \right) 
    = \nu_{ij} \nabla_i^2 {\bf u}_j
  \end{dmath}
  \begin{dmath}
    \nabla \cdot {\bf u} = 0 
  \end{dmath}
\end{dgroup*}

%% \begin{dgroup*}
%%   \begin{dmath}
%%     \int {\bf u} \cdot \nabla {\bf u} = {\bf u} \cdot {\bf u} - \int \nabla \cdot \left({\bf u} \right) \cdot {\bf u}
%%   \end{dmath}
%%   \begin{dmath}
%%     {\bf u} \cdot \nabla {\bf u} = \nabla \left( {\bf u} \cdot {\bf u} \right) - \left( \nabla \cdot {\bf u} \right) \cdot {\bf u}
%%   \end{dmath}
%% \end{dgroup*}

\section{Weak form:}

\begin{dmath}
  \int_\Omega {\bf v} \cdot \dot{{\bf u}} \; d\Omega + \int_\Omega {\bf v} \cdot {\bf u} \cdot \nabla {\bf u} \; d\Omega - \int_\Omega {\bf v} \cdot \nabla \cdot \nabla {\bf u} \; d\Omega = \int_\Omega {\bf v} \cdot {\bf f} \; d\Omega - \int_\Omega {\bf v} \cdot \nabla p \; d\Omega \condition{$\forall {\bf v}$}
\end{dmath}

\noindent
in 1D:
\begin{dmath}
  \int^b_a v \nabla \tau \; dx = \left . v \tau \right |^b_a - \int^b_a \nabla v \tau \; dx
\end{dmath}
in multiple dimensions:
\begin{dgroup*}
  \begin{dmath}
     \int_\Omega {\bf v} \cdot \nabla \cdot \nabla {\bf u} \; d\Omega = \int_\Upgamma {\bf v} \cdot \nabla {\bf u} \cdot n \; d\Upgamma - \int \nabla {\bf v} \cdot \nabla {\bf u}
  \end{dmath}
\end{dgroup*}

\begin{dgroup*}
  \begin{dmath}
    \int_\Omega {\bf v} \cdot \dot{{\bf u}} \; d\Omega + \int_\Omega {\bf v} \cdot {\bf u} \cdot \nabla {\bf u} \; d\Omega + \int_\Omega \nabla {\bf v} \cdot \nabla {\bf u} \; d\Omega = \int_\Omega {\bf v} \cdot {\bf f} \; d\Omega - \int_\Omega {\bf v} \cdot \nabla p \; d\Omega + \int_\Upgamma {\bf v} \cdot {\bf g} \; d\Upgamma \condition{$\forall {\bf v}$}
  \end{dmath}
  \begin{dmath}
    g = \nabla {\bf u} \cdot n
  \end{dmath}
\end{dgroup*}

%% \begin{dgroup*}
%%   \begin{dmath}
%%     \int {\bf v} \nabla p = {\bf v}p - \int \nabla \cdot {\bf v} p
%%   \end{dmath}
%%   \begin{dmath}
%%     {\bf v} \nabla p = \nabla \cdot \left( {\bf v}p \right) - \left(\nabla \cdot {\bf v} \right) p
%%   \end{dmath}
%% \end{dgroup*}

\begin{dmath}
  \int_\Omega q \nabla \cdot {\bf u} \; d\Omega = 0 \condition{$\forall q$}
\end{dmath}

\section{Time discretisation of momentum equation:}

\begin{dmath}
  \dot{{\bf u}} = \frac{{\bf u}_n - {\bf u}_{n-1}}{\Delta t}
\end{dmath}

\begin{dmath}
  \int_\Omega {\bf v} \cdot \frac{{\bf u}_n - {\bf u}_{n-1}}{\Delta t} \; d\Omega + \int_\Omega {\bf v} \cdot \tilde{{\bf u}} \cdot \nabla \bar{{\bf u}} \; d\Omega + \int_\Omega \nabla {\bf v} \cdot \nabla {\bf u}_{n-\alpha} \; d\Omega = \int_\Omega {\bf v} \cdot {\bf f} \; d\Omega + \int_\Omega {\bf v} \cdot \nabla p \; d\Omega + \int_\Upgamma {\bf v} \cdot {\bf g} \; d\Upgamma \condition{$\forall {\bf v}$}
\end{dmath}
\begin{dmath}
  \nabla {\bf u}_{n-\alpha} = \nu \left( \nabla {\bf u}_{n-\alpha} + \left(\nabla {\bf u}_{n-\alpha} \right)^\top \right) 
\end{dmath}

\begin{dmath}
  {\bf u}_{n-\alpha} = \alpha {\bf u}_{n-1} + \left( 1 - \alpha \right) {\bf u}_{n}
\end{dmath}
\begin{dmath}
  {\bf u}_{n-\alpha_{nl}} = \alpha_{nl} {\bf u}_{n-1} + \left( 1 - \alpha_{nl} \right) {\bf u}_{n*}
\end{dmath}
\begin{dgroup*}
\intertext{Explicit Adams Bashforth}
\begin{dmath}
  \bar{{\bf u}} = \frac{3}{2} {\bf u}_{n-1} - \frac{1}{2} {\bf u}_{n-2}
\end{dmath}, 
\begin{dmath}
  \tilde{{\bf u}} = \frac{3}{2} {\bf u}_{n-1} - \frac{1}{2} {\bf u}_{n-2}
\end{dmath}. 
\intertext{Forward Euler}
\begin{dmath}
  \bar{{\bf u}} = {\bf u}_{n-\alpha}
\end{dmath}, 
\begin{dmath}
  \tilde{{\bf u}} = {\bf u}_{n-1}
\end{dmath}. 
\intertext{Implicit Adams Bashforth}
\begin{dmath}
  \bar{{\bf u}} = {\bf u}_{n-\alpha}
\end{dmath}, 
\begin{dmath}
  \tilde{{\bf u}} = \frac{3}{2} {\bf u}_{n-1} - \frac{1}{2} {\bf u}_{n-2}
\end{dmath}. 
\intertext{Impicit - as Fluidity}
\begin{dmath}
  \bar{{\bf u}} = {\bf u}_{n-\alpha}
\end{dmath}, 
\begin{dmath}
  \tilde{{\bf u}} = {\bf u}_{n-\alpha_{nl}} 
\end{dmath}. 
\end{dgroup*}
%% \begin{dmath}
%%   \int_\Omega {\bf v} {\bf u} \; d\Omega + \int_\Omega {\bf v} {\bf u} \cdot \nabla {\bf u} \; d\Omega + \int_\Omega \nabla {\bf v} \cdot \nabla {\bf u} \; d\Omega = \int_\Omega {\bf v} {\bf f} \; d\Omega + \int_\Omega {\bf v} \nabla p \; d\Omega + \int_\Upgamma {\bf v} g \; d\Upgamma
%% \end{dmath}

\section{Pressure/Conservation:}

\subsection{Fully coupled:}

\begin{dmath}
  \int_\Omega {\bf v} \cdot \left({\bf u}_n - {\bf u}_{n-1} \right) \; d\Omega + \Delta t \int_\Omega {\bf v} \cdot \tilde{{\bf u}} \cdot \nabla \bar{{\bf u}} \; d\Omega + \Delta t \int_\Omega \nabla {\bf v} \cdot \nabla {\bf u}_{n-\alpha} \; d\Omega - \Delta t \int_\Omega {\bf v} \cdot {\bf f} \; d\Omega + \Delta t \int_\Omega {\bf v} \cdot \nabla p \; d\Omega - \Delta t \int_\Upgamma {\bf v} \cdot {\bf g} \; d\Upgamma = 0 \condition{$\forall {\bf v}$}
\end{dmath}

%% \begin{dgroup*}
%%   \begin{dmath}
%%     \int {\bf v} \nabla p = {\bf v}p - \int \nabla \cdot {\bf v} p
%%   \end{dmath}
%%   \begin{dmath}
%%     {\bf v} \nabla p = \nabla \cdot \left( {\bf v}p \right) - \left(\nabla \cdot {\bf v} \right) p
%%   \end{dmath}
%% \end{dgroup*}

%% \begin{dmath}
%%   \int_\Omega \nabla \cdot \left( {\bf v}p \right) \; d\Omega = \int_\Upgamma \left({\bf v}p \right) \cdot n \; d\Upgamma
%% \end{dmath}
%% \begin{dmath}
%%   \int_\Omega {\bf v} \left({\bf u}_n - {\bf u}_{n-1} \right) \; d\Omega + \Delta t \int_\Omega {\bf v} \tilde{{\bf u}} \cdot \nabla \bar{{\bf u}} \; d\Omega + \Delta t \int_\Omega \nabla {\bf v} \cdot \nabla {\bf u}_{n-\alpha} \; d\Omega - \Delta t \int_\Omega {\bf v} {\bf f} \; d\Omega-  \Delta t \int_\Omega \left(\nabla \cdot {\bf v} \right) p \; d\Omega - \Delta t \int_\Upgamma {\bf v} h \; d\Upgamma = 0
%% \end{dmath}

%% \begin{dmath}
%%   h = g + p \cdot n
%% \end{dmath}

\begin{dmath}
  \int_\Omega q \nabla \cdot {\bf u}_{n-\alpha} \; d\Omega = 0 \condition{$\forall q$}
\end{dmath}

Therefore:
\begin{dmath}
  \int_\Omega {\bf v} \cdot \left({\bf u}_n - {\bf u}_{n-1} \right) \; d\Omega + \Delta t \int_\Omega {\bf v} \cdot \tilde{{\bf u}} \cdot \nabla \bar{{\bf u}} \; d\Omega + \Delta t \int_\Omega \nabla {\bf v} \cdot \nabla {\bf u}_{n-\alpha} \; d\Omega \\ - \Delta t \int_\Omega {\bf v} \cdot {\bf f} \; d\Omega + \Delta t \int_\Omega {\bf v} \cdot \nabla p \; d\Omega + \int_\Omega q \nabla \cdot {\bf u}_{n-\alpha} \; d\Omega - \Delta t \int_\Upgamma {\bf v} \cdot {\bf g} \; d\Upgamma = 0 \condition{$\forall q \; \forall {\bf v}$}
\end{dmath}

\begin{dmath}
  \int_\Omega {\bf v} \cdot \nabla p \; d\Omega = \int_\Upgamma {\bf v} \cdot p \cdot n \; d\Upgamma - \int \left( \nabla \cdot {\bf v} \right) p \; d\Omega 
\end{dmath}

\begin{dmath}
  \int_\Omega {\bf v} \cdot \left({\bf u}_n - {\bf u}_{n-1} \right) \; d\Omega + \Delta t \int_\Omega {\bf v} \cdot \tilde{{\bf u}} \cdot \nabla \bar{{\bf u}} \; d\Omega + \Delta t \int_\Omega \nabla {\bf v} \cdot \nabla {\bf u}_{n-\alpha} \; d\Omega \\ - \Delta t \int_\Omega {\bf v} \cdot {\bf f} \; d\Omega - \Delta t \int \left( \nabla \cdot {\bf v} \right) p \; d\Omega + \int_\Omega q \nabla \cdot {\bf u}_{n-\alpha} \; d\Omega - \Delta t \int_\Upgamma {\bf v} \cdot {\bf g} \; d\Upgamma + \int_{\Upgamma_{/N}} {\bf v} \cdot p \cdot n \; d\Upgamma_{/N} + \int_{\Upgamma_N} {\bf v} \cdot p_N \cdot n \; d\Upgamma_N = 0 \condition{$\forall q \; \forall {\bf v}$}
\end{dmath}

\begin{dmath}
 \int_\Omega {\bf v} \cdot {\bf u} \cdot \nabla {\bf u} \; d\Omega = \int_\Upgamma \left( {\bf v} \cdot {\bf u} \right) \left( {\bf u} \cdot n \right) \; d\Upgamma - \int_\Omega \left( \nabla {\bf v} \cdot {\bf u} \right) {\bf u} \; d\Omega - \int_\Omega \left ( {\bf v} \cdot \nabla {\bf u} \right) {\bf u} \; d\Omega
\end{dmath}


\subsection{Incremental pressure correction (IPCS):}

Tentative velocity step:
\begin{dmath}
  \int_\Omega {\bf v} \frac{{\bf u}_* - {\bf u}_{n-1}}{\Delta t} \; d\Omega + \int_\Omega {\bf v} \tilde{{\bf u}} \cdot \nabla \bar{{\bf u}} \; d\Omega + \int_\Omega \nabla {\bf v} \cdot \nabla {\bf u}_{n-\alpha} \; d\Omega - \int_\Omega {\bf v} {\bf f} \; d\Omega + \int_\Omega {\bf v} \nabla p_{n-\frac{1}{2}} \; d\Omega \\ - \int_\Upgamma {\bf v} g \; d\Upgamma = 0 \condition{$\forall {\bf v}$}
\end{dmath}

Corrected velocity:
\begin{dmath}
  \int_\Omega {\bf v} \cdot \frac{{\bf u}_n - {\bf u}_{n-1}}{\Delta t} \; d\Omega + \int_\Omega {\bf v} \cdot \tilde{{\bf u}} \cdot \nabla \bar{{\bf u}} \; d\Omega + \int_\Omega \nabla {\bf v} \cdot \nabla {\bf u}_{n-\alpha} \; d\Omega - \int_\Omega {\bf v} {\bf f} \; d\Omega + \int_\Omega {\bf v} \cdot \nabla p_{n+\frac{1}{2}} \; d\Omega - \int_\Upgamma {\bf v} \cdot {\bf g} \; d\Upgamma = 0 \condition{$\forall {\bf v}$}
\end{dmath}

(26) - (25):
\begin{dmath}
  \int_\Omega {\bf v} \cdot \frac{{\bf u}_n - {\bf u}_*}{\Delta t} \; d\Omega + \int_\Omega {\bf v} \cdot \nabla \left(p_{n+\frac{1}{2}} - p_{n-\frac{1}{2}} \right) \; d\Omega = 0 \condition{$\forall {\bf v}$}
\end{dmath}

left multiply by the mass matrix and the transpose of the pressure gradient operator:

\begin{dmath}
  \int_\Omega \nabla q \cdot \frac{{\bf u}_n - {\bf u}_*}{\Delta t} \; d\Omega + \int_\Omega \nabla q \cdot \nabla \left(p_{n+\frac{1}{2}} - p_{n-\frac{1}{2}} \right) \; d\Omega = 0 \condition{$\forall q$}
\end{dmath}
\begin{dmath}
  \int_\Omega \nabla q \cdot {\bf u}_n \; d\Omega - \int_\Omega \nabla q \cdot {\bf u}_* \; d\Omega + \Delta t \int_\Omega \nabla q \cdot \nabla \left(p_{n+\frac{1}{2}} - p_{n-\frac{1}{2}} \right) \; d\Omega = 0 \condition{$\forall q$}
\end{dmath}

\begin{dmath}
  \int_\Omega q \nabla \cdot {\bf u}_{n} \; d\Omega = \int_\Upgamma q \left( {\bf u}_{n} \cdot n \right) \; d\Upgamma - \int_\Omega \nabla q \cdot {\bf u}_{n} = 0 \condition{$\forall q$}
\end{dmath}

\begin{dmath}
 \int_\Omega \nabla q \cdot {\bf u}_{n} = \int_\Upgamma q \left( {\bf u}_{n} \cdot n \right) \; d\Upgamma \condition{$\forall q$}
\end{dmath}

\begin{dmath}
  \int_\Omega \nabla q \cdot {\bf u}_* \; d\Omega - \int_\Upgamma q \left( {\bf u}_{n} \cdot n \right) \; d\Upgamma = \Delta t \int_\Omega \nabla q \cdot \nabla \left(p_{n+\frac{1}{2}} - p_{n-\frac{1}{2}} \right) \; d\Omega  \condition{$\forall q$}
\end{dmath}

%% \begin{dmath}
%%   \int_\Omega q \nabla \cdot {\bf u} \; d\Omega = 0
%% \end{dmath}

%% \begin{dgroup*}
%%   \begin{dmath}
%%     \int q \nabla \cdot {\bf u} = q \cdot {\bf u} - \int \nabla q \cdot {\bf u} 
%%   \end{dmath}
%%   \begin{dmath}
%%     \nabla \left(q \cdot {\bf u} \right) - \nabla q \cdot {\bf u} 
%%   \end{dmath}
%% \end{dgroup*}

%% \begin{dmath}
%%   \int_\Omega  \nabla \left(q \cdot {\bf u} \right) \; d\Omega = \int_\Upgamma \left( q \cdot {\bf u} \right) \cdot n \; d\Upgamma = \int_\Upgamma q {\bf u} \cdot n \; d\Upgamma
%% \end{dmath}

%% \begin{dmath}
%%   \int_\Omega \nabla q \cdot {\bf u} \; d\Omega - \int_\Upgamma q {\bf u} \cdot n \; d\Upgamma = 0
%% \end{dmath}

%% \begin{dmath}
%%   \left(\int_\Omega \nabla q \cdot {\bf u} \; d\Omega - \int_\Upgamma q {\bf u} \cdot n \; d\Upgamma \right)^\top = \int_\Omega \nabla p \cdot {\bf v} \; d\Omega - \int_\Upgamma p {\bf v} \cdot n \; d\Upgamma 
%% \end{dmath}


\section{Analytical solution:}

\begin{dgroup*}
  \begin{dmath}
    \dot{{\bf u}} = 0
  \end{dmath}
  \begin{dmath}
    {\bf u} = \begin{bmatrix} u \\ v \end{bmatrix}
  \end{dmath}
  \begin{dmath}
    u = \text{sin}(x)\text{cos}(y)
  \end{dmath}
  \begin{dmath}
    v = -\text{cos}(x)\text{sin}(y)
  \end{dmath}
  \begin{dmath}
    \nu = 1.0
  \end{dmath}
  \begin{dmath}
    p = \text{cos}(x)\text{cos}(y)
  \end{dmath}
\end{dgroup*}

\begin{dgroup*}
  \begin{dmath}
    \begin{bmatrix} \dot{u} \\ \dot{v} \end{bmatrix} + \begin{bmatrix} u \\ v \end{bmatrix} \cdot \nabla \begin{bmatrix} u \\ v \end{bmatrix} - \nu \nabla^2 \begin{bmatrix} u \\ v \end{bmatrix} = {\bf f} - \nabla p 
  \end{dmath}
  \begin{dmath}
    \begin{bmatrix} u \\ v \end{bmatrix} \cdot \begin{bmatrix} u_x & u_y \\ v_x & v_y \end{bmatrix} - \nu \begin{bmatrix} u_{xx} + u_{yy} \\ v_{xx} + v_{yy} \end{bmatrix} = {\bf f} - \nabla p 
  \end{dmath}
  \begin{dmath}
    \begin{bmatrix} u u_x + v u_y \\ u v_x + y v_y \end{bmatrix} - \nu \begin{bmatrix} u_{xx} + u_{yy} \\ v_{xx} + v_{yy} \end{bmatrix} + \begin{bmatrix} p_x \\ p_y \end{bmatrix} = {\bf f} 
    =  \begin{bmatrix} \text{sin}(x)\text{sin}(y)^2\text{cos}(x) + \text{sin}(x)\text{cos}(x)\text{cos}(y)^2 + 2\text{sin}(x)\text{cos}(y) \\ \text{sin}(x)^2\text{sin}(y)\text{cos}(y) + \text{sin}(y)\text{cos}(x)^2\text{cos}(y) - 2\text{sin}(x)\text{cos}(y) - 2\text{sin}(y)\text{cos}(x) \end{bmatrix}
  \end{dmath}
\end{dgroup*}

\section{DG Advection:}

\begin{dgroup}
  \begin{dmath}
    \nabla \cdot \left( {\bf u} c \right) = s
  \end{dmath}
  \intertext{Assume diffusivity is isentropic. Multiply by test function, integrate over each element, sum over the domain and integrate both left-hand side terms by parts}
  \begin{dmath}
    - \int_{\Omega} \nabla \phi \left( {\bf u} c \right) = - \sum_E \int_{E} \nabla \phi \left( {\bf u} c \right) = 
    \sum_E \int_{E} \phi s - \sum_E \int_{\partial E} \phi \, {\bf n} \cdot {\bf u} c
  \end{dmath}
  \begin{dmath}
    - \sum_E \int_{E} \nabla \phi_h \left( {\bf u}_h c_h \right) = 
    \sum_E \int_{E} \phi_h s_h - \sum_E \int_{\partial E} \phi_h \, {\bf n} \cdot {\bf u}_h^0 c_h^0
  \end{dmath}
  \begin{dmath}
    \sum_E \int_{\Omega} \phi_h \nabla \left( {\bf u}_h c_h \right) + \sum_E \int_{\partial E} \phi_h \, {\bf n} \cdot \left( {\bf u}_h^0 c_h^0 - {\bf u}_h c_h \right) - \sum_E \int_{\Omega} \phi_h s_h = 0    
  \end{dmath}
  \begin{dmath}
    \sum_E \int_{\Omega} \phi_h \nabla \left( {\bf u}_h c_h \right) + \sum_e \left[ \int_{\partial e'} \phi_h \, {\bf n} \cdot \left( {\bf u}_h^0 c_h^0 - {\bf u}_h c_h \right) + \int_{\partial e_D} \phi_h \, {\bf n} \cdot \left( {\bf u}_h g_D - {\bf u}_h c_h \right) \right] \\- \sum_E \int_{\Omega} \phi_h s_h = 0    
  \end{dmath}
\end{dgroup}
\begin{dgroup}
  \intertext{Using upwinding}
  \begin{dmath}
    {\bf u}_h^0 c_h^0 = {\bf u}_h^{up} c_h^{up}
  \end{dmath}
  \begin{dmath}
    \int_{\partial e'} \phi_h \, {\bf n} \cdot \left( {\bf u}_h^0 c_h^0 - {\bf u}_h c_h \right) = 
    \int_{\partial e'} \phi_h^+ \, {\bf n}^+ \cdot \left( {\bf u}_h^{up} c_h^{up} - {\bf u}_h^+ c_h^+ \right) +
    \int_{\partial e'} \phi_h^- \, {\bf n}^- \cdot \left( {\bf u}_h^{up} c_h^{up} - {\bf u}_h^- c_h^- \right)  
  \end{dmath}
  \begin{dmath}
    \gamma = \frac{\left( {\bf n} \cdot {\bf u} + \left| {\bf n} \cdot {\bf u} \right| \right)}{2 \left| {\bf n} \cdot {\bf u} \right|} , upwind \; 1.0, downwind \; 0.0
  \end{dmath}
  \begin{dmath}
    \int_{\partial e'} \phi_h^+ \, {\bf n}^+ \cdot \left( {\bf u}_h^{up} c_h^{up} - {\bf u}_h^+ c_h^+ \right) +
    \int_{\partial e'} \phi_h^- \, {\bf n}^- \cdot \left( {\bf u}_h^{up} c_h^{up} - {\bf u}_h^- c_h^- \right) =\\
    \int_{\partial e'} \left( \phi_h^+ \, {\bf n}^+ + \phi_h^- \, {\bf n}^- \right) \cdot \left( \gamma^+ {\bf u}_h^+ c_h^+  + \gamma^- {\bf u}_h^- c_h^- \right) - \int_{\partial e'} \left( \phi_h^+ \, {\bf n}^+ \cdot {\bf u}_h^+ c_h^+ + \phi_h^- \, {\bf n}^- \cdot {\bf u}_h^- c_h^- \right) = \\
    \int_{\partial e'} \left[\left[ \phi_h \, {\bf n} \right]\right] \cdot \left( \gamma^+ {\bf u}_h^+ c_h^+  + \gamma^- {\bf u}_h^- c_h^- \right) - \int_{\partial e'} \left[\left[ \phi_h \, {\bf n} \cdot {\bf u}_h c_h \right]\right]
  \end{dmath}
\end{dgroup}


  \begin{dmath}
    \sum_E \int_{\Omega} \phi_h \nabla \left( {\bf u}_h c_h \right) + \sum_e \left[ \int_{\partial e'} \left[\left[ \phi_h \, {\bf n} \right]\right] \cdot \left( \gamma^+ {\bf u}_h^+ c_h^+  + \gamma^- {\bf u}_h^- c_h^- \right) - \int_{\partial e'} \left[\left[ \phi_h \, {\bf n} \cdot {\bf u}_h c_h \right]\right] + \int_{\partial e_D} \phi_h \, {\bf n} \cdot \left( {\bf u}_h g_D - {\bf u}_h c_h \right) \right] \\- \sum_E \int_{\Omega} \phi_h s_h = 0    
  \end{dmath}


~

~

~

~

~

~

~

~

\begin{dgroup}
  \begin{dmath}
    - \sum_e \int_{\Omega} \nabla \phi_h \left( {\bf u}_h c_h \right) \; d{\Omega} = 
    \sum_e \int_{\Omega} \phi_h s_h \; d{\Omega} - \sum_f \int_{\Upgamma'} \phi_h \, {\bf n} \cdot {\bf u}_h^0 c_h^0 \; d{\Upgamma'} \\ - \sum_f \int_{\Upgamma_D} \phi_h \, {\bf n} \cdot {\bf u}_h g_D \; d{\Upgamma_D} - \sum_f \int_{\Upgamma_N} \phi_h \, {\bf n} \cdot {\bf u}_h c_h \; d{\Upgamma_N}
  \end{dmath}
  \begin{dmath}
    - \sum_e \int_{\Omega} \nabla \phi \left( {\bf u} c \right) \; d{\Omega} = 
    \sum_e \int_{\Omega} \phi s \; d{\Omega} - \sum_f \int_{\Upgamma} \phi \, {\bf n} \cdot {\bf u} c \; d{\Upgamma}
  \end{dmath}
  \intertext{Using upwinding}
  \begin{dmath}
    \sum_f \int_{\Upgamma} \phi \, {\bf n} \cdot {\bf u} c \; d{\Upgamma} = 
    \sum_f \left[ \int_{\Upgamma} \phi_{down} \, \left( {\bf n} \cdot {\bf u} c \right)_{up} \; d{\Upgamma} + \int_{\Upgamma} \phi_{up} \, \left( {\bf n} \cdot {\bf u} c \right)_{up} \; d{\Upgamma} \right] =
    \sum_f \left( \phi_{up} + \phi_{down} \right)  \left( {\bf n} \cdot {\bf u} c \right)_{up} \; d{\Upgamma} 
  \end{dmath}
  \intertext{In FEniCS +/- is abitrary and normal is oriented to each element. Jump is defined as:}
  \begin{dmath}
    \left[\left[\phi \right]\right] = \phi_+ - \phi_-
  \end{dmath}
  \intertext{Therefore:}
  \begin{dmath}
    \gamma = \frac{1}{2} \left( {\bf n} \cdot {\bf u} + \left| {\bf n} \cdot {\bf u} \right| \right)  
  \end{dmath}
  \begin{dmath}
    \sum_f \left( \phi_{up} + \phi_{down} \right)  \left( {\bf n} \cdot {\bf u} c \right)_{up} \; d{\Upgamma} = \sum_f \int_{\Upgamma} \left[\left[\phi \right]\right] \left( \gamma_+ c_+ - \gamma_- c_- \right)  \; d{\Upgamma}
  \end{dmath}
\end{dgroup}
\begin{dmath}
  - \sum_e \int_{\Omega} \nabla \phi \left( {\bf u} c \right) \; d{\Omega}
  + \sum_f \int_{\Upgamma} \left[\left[\phi \right]\right] \left( \gamma_+ c_+ - \gamma_- c_- \right) \; d{\Upgamma} = 0
\end{dmath}

\section{DG Diffusion:}

\begin{dgroup*}
\begin{dmath}
  - \nabla \cdot \left( \bar{\bar{\kappa}} \cdot \nabla c \right) = s
\end{dmath}
\intertext{Assume diffusivity is isentropic. Second derivative of DG is unreal so we discretise the derivative first}
\begin{dmath}
  - \nabla \cdot \left( \bar{\bar{\kappa}} \cdot {\bf q} \right) = s
\end{dmath}
\begin{dmath}
  - \sum_e \int_{\Omega} \phi \nabla \cdot \left( \kappa {\bf q} \right)  \; d{\Omega}= \int_{\Omega} \phi s \; d{\Omega}
\end{dmath}
\begin{dmath}
  \sum_e \int_{\Omega} \nabla \phi \cdot \left( \kappa {\bf q} \right)  \; d{\Omega} = \sum_e \int_{\Omega} \phi s  \; d{\Omega} + \sum_f \int_{\Upgamma} \phi {\bf n} \cdot \kappa {\bf q} \; d{\Upgamma}
\end{dmath}
\begin{dmath}
  \sum_e \int_{\Omega} \nabla \phi \cdot \left( \kappa {\bf q} \right)  \; d{\Omega} = \sum_e \int_{\Omega} \phi s  \; d{\Omega} + \sum_f \int_{\Upgamma}  \left( \phi_{up} \cdot {\bf n}_{up} + \phi_{down} \cdot {\bf n}_{down} \right)  \left(\kappa {\bf q} \right)_{up} \; d{\Upgamma}
\end{dmath}
\end{dgroup*}

\begin{dgroup*}
\begin{dmath}
  \nabla c = {\bf q}
\end{dmath}
\begin{dmath}
  \int_{\Omega} {\bf w} \cdot \nabla c  \; d{\Omega} = \int_{\Omega} {\bf w} \cdot {\bf q}  \; d{\Omega}
\end{dmath}
\begin{dmath}
  - \sum_e \int_{\Omega} \nabla \cdot {\bf w} c  \; d{\Omega} = \int_{\Omega} {\bf w} \cdot {\bf q}  \; d{\Omega} - \sum_f \int_{\Upgamma} {\bf w} \cdot {\bf n} \, c \; d{\Upgamma}
\end{dmath}
\begin{dmath}
  \sum_f \int_{\Upgamma} {\bf w} \cdot {\bf n} \, c \; d{\Upgamma} = \sum_f \left[ \int_{\Upgamma} \left( {\bf n} \cdot {\bf w} \right)_{down} \, c_{up} \; d{\Upgamma} + \int_{\Upgamma} \left( {\bf n} \cdot {\bf w} \right)_{up} \, c_{up} \; d{\Upgamma} \right] =
    \sum_f \int_{\Upgamma} \left( {\bf n}_{up} \cdot {\bf w}_{up} + {\bf n}_{down} \cdot {\bf w}_{down} \right)  c_{up} \; d{\Upgamma} 
\end{dmath}
\end{dgroup*}

\begin{dmath}
   \int_{\Omega} {\bf w} \cdot {\bf q}  \; d{\Omega} = \sum_f \int_{\Upgamma} \left( {\bf n}_{up} \cdot {\bf w}_{up} + {\bf n}_{down} \cdot {\bf w}_{down} \right)  c_{up} \; d{\Upgamma} - \sum_e \int_{\Omega} \nabla \cdot {\bf w} c  \; d{\Omega}
\end{dmath}

\section{k-$\epsilon$:}

\subsection{momentum equation}

\begin{dmath}
  \frac{\partial u_i}{\partial t} + u_j \frac{\partial u_i}{\partial x_j} - \frac{\partial \tau_{ij}}{\partial x_j} - \frac{\partial \tau_{ij}^R}{\partial x_j} = - \frac{\partial p}{\partial x_i} + s_i
\end{dmath}

\begin{dmath}
  \tau_{ij} = \nu \left( \frac{\partial u_i}{\partial x_j} + \frac{\partial u_j}{\partial x_i} \right)
\end{dmath}
\begin{dmath}
  \tau_{ij}^R = \nu \left( \frac{\partial u_i}{\partial x_j} + \frac{\partial u_j}{\partial x_i} \right) - \frac{2}{3} k \delta_{ij}
\end{dmath}

\subsubsection{weak form}

\begin{dmath}
  \int_\Omega \phi \frac{\partial u_i}{\partial t} \; dx + \int_\Omega \phi u_j \frac{\partial u_i}{\partial x_j} \; dx - \int_\Omega \phi \frac{\partial \tau_{ij}}{\partial x_j} \; dx - \int_\Omega \phi \frac{\partial \tau_{ij}^R}{\partial x_j} \; dx = \\ - \int_\Omega \phi \frac{\partial p}{\partial x_i} \; dx + \int_\Omega \phi \rho_* g_i \; dx + \int_\Omega \phi s_i \; dx
\end{dmath}

\begin{dmath}
  \int_\Omega \phi \frac{\partial u_i}{\partial t} \; dx + \int_\Omega \phi u_j \frac{\partial u_i}{\partial x_j} \; dx + \int_\Omega \frac{\partial \phi}{\partial x_j} \tau_{ij} \; dx - \int_\Omega \phi \frac{\partial \tau_{ij}^R}{\partial x_j} \; dx = \\ - \int_\Omega \phi \frac{\partial p}{\partial x_i} \; dx + \int_\Omega \phi \rho_* g_i \; dx + \int_\Omega \phi s_i \; dx + \int_\Upgamma \phi \tau_{ij} \; dx
\end{dmath}

Always dirichlet or zero neumann boundary conditions:

\begin{dmath}
  \int_\Omega \phi \frac{\partial u_i}{\partial t} \; dx + \int_\Omega \phi u_j \frac{\partial u_i}{\partial x_j} \; dx + \int_\Omega \frac{\partial \phi}{\partial x_j} \tau_{ij} \; dx - \int_\Omega \phi \frac{\partial \tau_{ij}^R}{\partial x_j} \; dx = \\ - \int_\Omega \phi \frac{\partial p}{\partial x_i} \; dx + \int_\Omega \phi \rho_* g_i \; dx + \int_\Omega \phi s_i \; dx
\end{dmath}

\subsection{turbulent kinetic energy}

\begin{dmath}
  \frac{\partial k_i}{t} + \frac{\partial \left( {\bf u} k \right)_i}{\partial x_j} - \frac{\partial}{\partial x_j} \left( \nu_T \frac{\partial k}{x_j} \right) = s + \frac{\partial u_i}{\partial x_j} \tau_{ij}^R - \epsilon
\end{dmath}

\begin{dmath}
  \frac{\partial k_i}{t} + \frac{\partial \left( {\bf u} k \right)_i}{\partial x_j} - \nu_T \frac{\partial}{x_j}\left( \frac{\partial k}{x_j} \right) - \frac{\partial \nu_T}{\partial x_j} \frac{\partial k}{\partial x_j} = s + \frac{\partial u_i}{\partial x_j} \tau_{ij}^R - \epsilon
\end{dmath}

\begin{dmath}
  \int_\Omega \eta \frac{\partial k_i}{t} \; dx + \int_\Omega \eta \frac{\partial \left( {\bf u} k \right)_i}{\partial x_j} \; dx - \int_\Omega \eta \frac{\partial}{\partial x_j} \left( \nu_T \frac{\partial k}{x_j} \right) \; dx = \int_\Omega \eta s \; dx + \int_\Omega \eta \frac{\partial u_i}{\partial x_j} \tau_{ij}^R \; dx - \int_\Omega \eta \epsilon \; dx
\end{dmath}

\bibliography{/data/sp911/documents/Bibliography/Bibliography}

\end{document}
