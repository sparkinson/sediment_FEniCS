#!/usr/bin/env python
# -*- coding: utf-8 -*-
from __future__ import unicode_literals
from numpy import *
from matplotlib.pyplot import *
# from matplotlib import rc
import matplotlib as mpl
from matplotlib.ticker import ScalarFormatter, FormatStrFormatter

mpl.rcParams['text.usetex']=True
mpl.rcParams['text.latex.unicode']=True
rc('font',**{'family':'serif','serif':['cm']})

class FixedOrderFormatter(ScalarFormatter):
    """Formats axis ticks using scientific notation with a constant order of 
    magnitude"""
    def __init__(self, order_of_mag=0, format=None, useOffset=True, useMathText=False):
        self._order_of_mag = order_of_mag

        self.set_useOffset(useOffset)
        self._usetex = rcParams['text.usetex']
        self._useMathText = useMathText
        self.orderOfMagnitude = 0
        self.format = ''
        self._scientific = True
        self._powerlimits = rcParams['axes.formatter.limits']
        if format is None:
            self._useLocale = rcParams['axes.formatter.use_locale']
        else:
            self._useLocale = True
            self.format = format
            self.custom_format = True

    def _set_orderOfMagnitude(self, range):
        """Over-riding this to avoid having orderOfMagnitude reset elsewhere"""
        self.orderOfMagnitude = self._order_of_mag

    def _set_format(self):
        # set the format string to format all the ticklabels
        # The floating point black magic (adding 1e-15 and formatting
        # to 8 digits) may warrant review and cleanup.
        if not self.custom_format:
            locs = (np.asarray(self.locs)-self.offset) / 10**self.orderOfMagnitude+1e-15
            sigfigs = [len(str('%1.8f'% loc).split('.')[1].rstrip('0')) \
                           for loc in locs]
            sigfigs.sort()
            self.format = '%1.' + str(sigfigs[-1]) + 'f'
            if self._usetex:
                self.format = '$%s$' % self.format
            elif self._useMathText:
                self.format = '$\mathdefault{%s}$' % self.format

x_0 = linspace(0.0,0.8,41)

x_N = linspace(0.0,5.085,41)

phi_ic_T = [0.013000000000000003, 0.013021578663868104, 0.013086181615834041, 0.013193410557216262, 0.013342604385933926, 0.01353284327242099, 0.013762954330681424, 0.014031518849521358, 0.014336881039375367, 0.014677158240799784, 0.015050252531694168, 0.015453863661688718, 0.015885503233952686, 0.016342510046988359, 0.016822066501823173, 0.017321215973444368, 0.01783688103937537, 0.018365882453008665, 0.01890495874471838, 0.019450786329905094, 0.01999999999999999, 0.020549213670094921, 0.02109504125528161, 0.021634117546991339, 0.022163118960624631, 0.02267878402655563, 0.023177933498176831, 0.023657489953011639, 0.024114496766047312, 0.024546136338311288, 0.024949747468305833, 0.025322841759200226, 0.025663118960624634, 0.025968481150478631, 0.02623704566931858, 0.02646715672757901, 0.026657395614066087, 0.026806589442783732, 0.026913818384165959, 0.026978421336131906, 0.026999999999999993]

phi_ic_0 = [0.0099999999999999985, 0.0099999999999999985, 0.0099999999999999967, 0.010000000000000005, 0.010000000000000002, 0.01, 0.010000000000000002, 0.01, 0.0099999999999999985, 0.010000000000000002, 0.0099999999999999967, 0.010000000000000002, 0.0099999999999999967, 0.0099999999999999985, 0.0099999999999999985, 0.01, 0.01, 0.0099999999999999985, 0.01, 0.0099999999999999985, 0.01, 0.01, 0.0099999999999999985, 0.0099999999999999985, 0.010000000000000002, 0.0099999999999999967, 0.01, 0.0099999999999999985, 0.0099999999999999985, 0.010000000000000002, 0.0099999999999999967, 0.01, 0.0099999999999999985, 0.0099999999999999985, 0.010000000000000002, 0.0099999999999999967, 0.01, 0.0099999999999999985, 0.0099999999999999985, 0.010000000000000002, 0.0099999999999999967]

phi_ic_final = [0.012999893862646873, 0.013022269318419202, 0.013087193347287446, 0.013195328856307897, 0.01334321760890271, 0.013530173978766307, 0.01375949167012047, 0.014031021275489254, 0.014340323276376082, 0.014682508814798519, 0.015054706938979468, 0.015455807698180076, 0.015885073242917377, 0.016341084987195647, 0.016821412720098468, 0.017322750875796933, 0.017841211383350247, 0.018372619643170308, 0.018912795760261294, 0.019457815647953246, 0.020004232078602968, 0.020549188126857895, 0.021090359730351893, 0.021625719968861052, 0.022153198005531134, 0.022670353016833244, 0.023174157860127123, 0.023660920757994829, 0.024126345959869518, 0.024565754874367213, 0.024974492679987654, 0.025348396611169045, 0.025684079591312466, 0.02597904711235114, 0.02623207386768759, 0.026443894049657225, 0.02661740352324406, 0.026757289315456092, 0.02687017055776094, 0.026967457890574698, 0.027008003505992584]

c_d_T = [6.5649257536392949e-05, 6.6575022541419095e-05, 6.8527985522888791e-05, 7.1242613197838162e-05, 7.4468794636971627e-05, 7.7904534167822325e-05, 8.1030479297978654e-05, 8.3322398833336907e-05, 8.4725214288323942e-05, 8.561764398949185e-05, 8.6263911719507247e-05, 8.6649101928761306e-05, 8.6727224865617295e-05, 8.6505533032761389e-05, 8.5987939680673322e-05, 8.5177523536890287e-05, 8.4083314096627466e-05, 8.2713576935427064e-05, 8.1077713942716263e-05, 7.918595016404828e-05, 7.7048631265758008e-05, 7.4676689143240955e-05, 7.2081352574323459e-05, 6.927428922496951e-05, 6.6267685746228947e-05, 6.3074304776181885e-05, 5.9707564166584952e-05, 5.6181412675144893e-05, 5.2509960483889398e-05, 4.870675052552294e-05, 4.4783816267907861e-05, 4.075090480624077e-05, 3.6615315894803236e-05, 3.2382541432768536e-05, 2.8057383699537125e-05, 2.3644942798481581e-05, 1.9151019763447921e-05, 1.458190972080768e-05, 9.9438717772645684e-06, 5.2426235418146722e-06, 4.8316402466496314e-07]

c_d_final = [6.5647719747544947e-05, 6.6575872516362171e-05, 6.8528611540211122e-05, 7.1242177584040172e-05, 7.4467718183141704e-05, 7.7904182113497125e-05, 8.1030787239982135e-05, 8.3322861830013644e-05, 8.4725795741163513e-05, 8.5618471433275561e-05, 8.6264603826885166e-05, 8.6649431345456698e-05, 8.6727281100416054e-05, 8.6505554299040477e-05, 8.5988139801485361e-05, 8.5177938867545016e-05, 8.408379483852879e-05, 8.2713878511994643e-05, 8.1077611474972649e-05, 7.9185333174005144e-05, 7.7047555444105528e-05, 7.4675372396627057e-05, 7.2080124380657793e-05, 6.9273505148602878e-05, 6.6267630731936915e-05, 6.3075108330739739e-05, 5.970914992316202e-05, 5.6183496584843078e-05, 5.2512101931384741e-05, 4.8708448641845783e-05, 4.4784632930272602e-05, 4.0750586052634361e-05, 3.6613876940844624e-05, 3.2380281642094749e-05, 2.8054813553865266e-05, 2.3642635040166867e-05, 1.9149429496054728e-05, 1.4581225106219275e-05, 9.9439477491853546e-06, 5.243020470080787e-06, 4.8327618078395206e-07]

fig = figure(1, figsize = (10, 5))
fig.subplots_adjust(wspace=0.4, hspace=0.4, left=0.1, right=0.9, top=0.9, bottom=0.1)

ax = fig.add_subplot(121, axisbg='w')
ax.plot(x_0, phi_ic_T, label=r'$\varphi_{0T}$', ls='--', color='k', lw=3)
ax.plot(x_0, phi_ic_0, label=r'initial $\varphi_{0}$')
ax.plot(x_0, phi_ic_final, label=r'optimised $\varphi_{0}$')

# ax.set_title(r'Target initial conditions $\varphi_{0T}$')
           
ax.set_xlabel(r'$x$')
ax.set_ylabel(r'$\varphi_0$')
ax.set_xlim([0.0,0.03])
ax.autoscale(enable=True, axis='x', tight=True)
ax.xaxis.set_major_formatter(FormatStrFormatter('%2.1f'))
ax.yaxis.set_major_formatter(FixedOrderFormatter(-2, '%2.1f'))

ax.legend(loc=2)

ax = fig.add_subplot(122, axisbg='w')
ax.plot(x_N, c_d_T, label=r'$\phi_{dT}$', ls='--', color='k', lw=3)
ax.plot(x_N, c_d_final, label=r'optimised $\phi_d$')

# ax.set_title(r'Target initial conditions $\varphi_{0T}$')

ax.legend(loc=3)
           
ax.set_xlabel(r'$x$')
ax.set_ylabel(r'$\phi_d$')
ax.set_xlim([0.0,0.03])
ax.autoscale(enable=True, axis='x', tight=True)
ax.xaxis.set_major_formatter(FormatStrFormatter('%2.1f'))
ax.yaxis.set_major_formatter(FixedOrderFormatter(-5, '%2.1f'))

fig.tight_layout()

fig.savefig('1_comp.png')

j = [0.0010100000000000005, 0.00026717292089201215, 7.579328580847561e-05, 9.007737491890622e-05, 5.203202842861048e-05, 3.9382243469277965e-05, 2.0789316966805305e-05, 1.9995894973507885e-05, 1.350955910040508e-05, 9.346484755104638e-06, 8.017917309750794e-06, 6.114235287422998e-06, 3.862530633325912e-06, 4.004923101457512e-06, 2.7574134753813854e-06, 1.8921316674964412e-06, 1.5928491740648392e-06, 1.4621644790016146e-06, 7.598168857681696e-07, 7.28250052132963e-07, 6.9344133131793e-07, 6.614854721445712e-07, 6.216703167518507e-07, 6.711511146830657e-07, 6.139322447812028e-07, 6.067467467643327e-07, 6.038951124828072e-07, 3.061992721486011e-07, 3.0525453321192197e-07, 3.026184030203978e-07, 3.0185372789328173e-07, 3.012035205907055e-07, 3.009383695290499e-07, 3.0075903568774967e-07, 3.0061716359367177e-07, 1.508626162034436e-07, 1.507576879988393e-07, 1.5064258065163226e-07, 1.506100040250578e-07, 1.505739418837163e-07, 1.5055110983172233e-07, 1.5052431741246377e-07, 1.5050293833142403e-07, 7.542287981775677e-08, 7.539773210482466e-08, 7.53742088018413e-08, 7.536764330964077e-08, 7.535753787909858e-08, 7.534620225149586e-08, 7.533455429106897e-08, 7.532855803920537e-08, 3.771808366477961e-08, 3.771335509972984e-08, 3.770957221204693e-08, 3.7708188240331057e-08, 3.770447736781738e-08, 3.769972508501031e-08, 3.769483911738393e-08, 3.76916436480959e-08, 1.8865713104125796e-08, 1.8864837334627524e-08, 1.8863871405814155e-08, 1.8863230769327163e-08, 1.8861405835222422e-08, 1.885972634432966e-08, 1.8858295916140047e-08, 1.8857500301949205e-08, 9.439716681507614e-09, 9.439313395196686e-09, 9.438489547305321e-09, 9.437903051346059e-09, 9.436689474218207e-09, 9.436906680834714e-09, 9.436024941863919e-09, 9.435234947923037e-09, 9.434496107452033e-09, 4.72393688522012e-09, 4.7236605496803195e-09, 4.723078321648528e-09, 4.722648201996683e-09, 4.721793330227978e-09, 4.722163869087026e-09, 4.721412953613638e-09, 4.721003414100139e-09, 4.7205929782298634e-09, 2.364639377725973e-09, 2.364494217938086e-09, 2.364141650957957e-09, 2.3638577559936405e-09, 2.3633122299510847e-09, 2.363528168552656e-09, 2.3630576276075152e-09, 2.3627658310863445e-09, 2.3624054555140014e-09, 1.1841690379514162e-09, 1.1840628256762632e-09, 1.1838042519459973e-09, 1.183595077689556e-09, 1.1832364397396629e-09, 1.183451398403036e-09, 1.1830960692919425e-09, 1.182935757601202e-09, 1.1827245614379551e-09, 5.935050003603945e-10, 5.934416461183022e-10, 5.932963115869051e-10, 5.931711157722075e-10, 5.929392821035886e-10, 5.930954219281895e-10, 5.928404692686278e-10, 5.926742779914575e-10, 5.924721968995902e-10, 2.97815113213206e-10, 2.977740196054024e-10, 2.976390221305294e-10, 2.9751952371504893e-10, 2.9735951339317556e-10, 2.973742505766657e-10, 2.9730339353135067e-10, 2.972498148341937e-10, 2.9707420588102915e-10, 1.4972962266716548e-10, 1.496714510128713e-10, 1.4961638853575483e-10, 1.495794727377482e-10, 1.4950427804335856e-10, 1.4939460215944226e-10, 1.4943177126597296e-10, 1.4932460400947205e-10, 1.4919008322108525e-10]

fig2 = figure(2, figsize = (10, 5))
fig2.subplots_adjust(wspace=0.4, hspace=0.4, left=0.1, right=0.9, top=0.9, bottom=0.1)

ax = fig2.add_subplot(111, axisbg='w')
ax.semilogy(j, label=r'$F$', ls='-', color='k', lw=1)

# ax.set_title(r'Target initial conditions $\varphi_{0T}$')
           
ax.set_xlabel(r'$iteration$')
ax.set_ylabel(r'$F$')
ax.set_xlim([0.0,0.03])
ax.autoscale(enable=True, axis='x', tight=True)

fig2.tight_layout()

fig2.savefig('1_j.png')

x_N = linspace(0.0,3.77,41)

c_d_final = [1.3767321471753813e-05, 1.436874744930114e-05, 1.5486228318007011e-05, 1.58673713120798e-05, 1.6260154076549781e-05, 1.6725510399665017e-05, 1.7106241245474679e-05, 1.7753087337023401e-05, 1.8796064192643874e-05, 2.0043934772777241e-05, 2.1072380285082613e-05, 2.1733817033152068e-05, 2.2218868245052826e-05, 2.2779689752955693e-05, 2.3449948906224401e-05, 2.4152404308527357e-05, 2.4871315424806364e-05, 2.5640241115109031e-05, 2.6449044706794694e-05, 2.7250548754259279e-05, 2.8013756460244546e-05, 2.8730567759381248e-05, 2.9405367698567165e-05, 3.0048347717358603e-05, 3.065840927765707e-05, 3.1212396279300761e-05, 3.1669560029915093e-05, 3.1977457591946514e-05, 3.207686627097092e-05, 3.1906873685855639e-05, 3.1407976796518527e-05, 3.0524739416153741e-05, 2.9208651755795789e-05, 2.7420539901964395e-05, 2.5132589788999858e-05, 2.2329107681787013e-05, 1.9005389530036599e-05, 1.5164768597669619e-05, 1.0814285195692105e-05, 5.9600143983202086e-06, 6.0312852059020378e-07]

phi_ic_0 = [0.0050000000000000001, 0.0050000000000000001, 0.0050000000000000001, 0.0050000000000000027, 0.005000000000000001, 0.0050000000000000001, 0.005000000000000001, 0.0050000000000000001, 0.0050000000000000001, 0.005000000000000001, 0.0050000000000000001, 0.005000000000000001, 0.0050000000000000001, 0.0050000000000000001, 0.0050000000000000001, 0.0050000000000000001, 0.0050000000000000001, 0.0050000000000000001, 0.0050000000000000001, 0.0050000000000000001, 0.0050000000000000001, 0.0050000000000000001, 0.0050000000000000001, 0.0050000000000000001, 0.005000000000000001, 0.0050000000000000001, 0.0050000000000000001, 0.0050000000000000001, 0.0050000000000000001, 0.005000000000000001, 0.0050000000000000001, 0.0050000000000000001, 0.0050000000000000001, 0.0050000000000000001, 0.005000000000000001, 0.0050000000000000001, 0.0050000000000000001, 0.0050000000000000001, 0.0050000000000000001, 0.005000000000000001, 0.0050000000000000001]

phi_ic_final = [0.0050000000000000001, 0.0050000000000000001, 0.0050000000000000001, 0.0050000000000000001, 0.0050000000000000001, 0.0053946777667464993, 0.0086252682690105657, 0.0084990834027791565, 0.0063245583751719639, 0.0051578354730449881, 0.0051363533869941075, 0.0050000000000000001, 0.0050000000000000001, 0.0050000000000000001, 0.0050000000000000001, 0.0050000000000000001, 0.0050000000000000001, 0.0050000000000000001, 0.0081699318143379374, 0.010799448169126907, 0.0069522891387835033, 0.0050000000000000001, 0.0050000000000000001, 0.0050000000000000001, 0.0050000000000000001, 0.0050000000000000001, 0.0050000000000000001, 0.0050000000000000001, 0.0050000000000000001, 0.0050000000000000001, 0.0067275030909721553, 0.011554139823963154, 0.017064879779728249, 0.022710304659517108, 0.028188143295483029, 0.033263869688216201, 0.037777465454695097, 0.041728288492283772, 0.04559504886406697, 0.050000000000000003, 0.050000000000000003]

fig3 = figure(3, figsize = (10, 5))
fig3.subplots_adjust(wspace=0.4, hspace=0.4, left=0.1, right=0.9, top=0.9, bottom=0.1)

ax = fig3.add_subplot(121, axisbg='w')
ax.plot(x_0, phi_ic_0, label=r'initial $\varphi_{0}$')
ax.plot(x_0, phi_ic_final, label=r'optimised $\varphi_{0}$')

# ax.set_title(r'Target initial conditions $\varphi_{0T}$')
           
ax.set_xlabel(r'$x$')
ax.set_ylabel(r'$\varphi_0$')
ax.autoscale(enable=True, axis='x', tight=True)
ax.xaxis.set_major_formatter(FormatStrFormatter('%2.1f'))
ax.yaxis.set_major_formatter(FixedOrderFormatter(-2, '%2.1f'))

ax.legend(loc=2)

ax = fig3.add_subplot(122, axisbg='w')
ax.plot(x_N, c_d_final, label=r'optimised $\phi_d$')

# ax.set_title(r'Target initial conditions $\varphi_{0T}$')

ax.legend(loc=3)
           
ax.set_xlabel(r'$x$')
ax.set_ylabel(r'$\phi_d$')
# ax.set_xlim([0.0,0.03])
# ax.autoscale(enable=True, axis='x', tight=True)
ax.set_xlim([0.8,4.0])
ax.xaxis.set_major_formatter(FormatStrFormatter('%2.1f'))
ax.yaxis.set_major_formatter(FixedOrderFormatter(-5, '%2.1f'))

fig3.tight_layout()

fig3.savefig('2_comp.png')

j = [-0.0010000000000000018, -0.0008820126961712724, -0.0001922086901519919, -0.00010910174706050917, -8.008413922498445e-05, -5.485325860658372e-05, -3.909454946434344e-05, -3.8344241447683825e-05, -1.9850017887588378e-05, -1.4547801381373335e-06, 3.775113779693163e-05, 5.019019771002421e-05, 6.0188042671468505e-05, 6.748741184305493e-05, 7.387125020585316e-05, 7.861318236348227e-05, 7.972489947825883e-05, 8.061492047958642e-05, 8.197614220009056e-05, 8.451913261396936e-05, 8.565041588128565e-05, 8.701989704148888e-05, 8.831114327311081e-05, 9.066252123188183e-05, 9.135059960672523e-05, 9.28208670411015e-05, 9.288230394224801e-05, 9.372212751660162e-05, 9.413698178888779e-05, 9.458660245673433e-05, 9.488095124574377e-05, 9.499913722850005e-05, 9.50405010616263e-05, 9.506587528052068e-05, 9.507527553470774e-05, 9.507786663106896e-05, 9.507849291015756e-05]

fig4 = figure(4, figsize = (10, 5))
fig4.subplots_adjust(wspace=0.4, hspace=0.4, left=0.1, right=0.9, top=0.9, bottom=0.1)

ax = fig4.add_subplot(111, axisbg='w')
ax.plot(j, label=r'$F_2$', ls='-', color='k', lw=1)

# ax.set_title(r'Target initial conditions $\varphi_{0T}$')
           
ax.set_xlabel(r'$iteration$')
ax.set_ylabel(r'$F_2$')
ax.set_xlim([0.0,0.03])
ax.autoscale(enable=True, axis='x', tight=True)
ax.yaxis.set_major_formatter(FixedOrderFormatter(-4, '%2.1f'))

fig4.tight_layout()

fig4.savefig('2_j.png')
